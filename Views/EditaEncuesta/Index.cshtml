@model EncuestasEvaluacionLiderazgo.Models.Encuesta

@{
    ViewData["Title"] = "Editar Encuesta: " + Model.Titulo;
    var indexModel = new EncuestasEvaluacionLiderazgo.Views.EditaEncuesta.IndexModel();
}

<div class="w-full mx-auto py-8">
    <!-- Encabezado -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Editar Encuesta</h1>
        <p class="text-gray-600">Modifica los detalles y preguntas de tu encuesta</p>
    </div>

    <!-- Informaci√≥n de Estado -->
    <div class="mb-8 p-6 @indexModel.GetEstadoBgClase(Model.Estado) rounded-lg">
        <div class="flex justify-between items-center">
            <div>
                <p class="text-sm opacity-75">Estado Actual</p>
                <p class="text-lg font-bold">@indexModel.GetEstadoTexto(Model.Estado)</p>
            </div>
            @if (Model.Estado == EncuestasEvaluacionLiderazgo.Models.EstadoEncuesta.Borrador)
            {
                <form method="post" asp-action="Publish" asp-route-id="@Model.Id" class="inline">
                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-bold">
                        üì§ Publicar Encuesta
                    </button>
                </form>
            }
            @if (Model.Estado != EncuestasEvaluacionLiderazgo.Models.EstadoEncuesta.Cerrada)
            {
                <form method="post" asp-action="UpdateEstado" asp-route-filtroTipo="@(ViewBag.FiltroTipo ?? Model.Id.ToString())" asp-route-id="@Model.Id" class="inline">
                    @{
                        bool esActivo = indexModel.GetEstadoActivoEncuesta(ViewBag.FiltroTipo ?? "");
                    }
                    <select name="estado" class="px-4 py-2 border border-gray-300 rounded-lg hover:border-gray-400 transition font-bold">
                        @if (esActivo)
                        {
                            <option value="true" selected>Activo</option>
                            <option value="false">Baja</option>
                        }
                        else
                        {
                            <option value="true">Activo</option>
                            <option value="false" selected>Baja</option>
                        }
                    </select>
                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition font-bold"
                            onclick="return confirm('¬øEst√°s seguro de que deseas actualizar el estado de la encuesta?')">
                        ‚úì Actualizar
                    </button>
                </form>
            }
        </div>
    </div>

    <!-- Tabs/Secciones -->
    <div class="mb-8">
        <ul class="flex border-b border-gray-300">
            <li class="mr-6">
                <button type="button" class="py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-bold active-tab" data-tab="detalles">
                    ‚ÑπÔ∏è Detalles
                </button>
            </li>
        </ul>
    </div>

    <!-- TAB 1: Detalles -->
    <div id="tab-detalles">
        <form method="post" asp-action="Update" class="bg-white rounded-lg shadow-md p-8 space-y-6">
            <!-- Validaci√≥n General -->
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
                    <p class="font-bold">Errores en el formulario:</p>
                    <ul class="mt-2 space-y-1">
                        @foreach (var modelState in ViewData.ModelState.Values)
                        {
                            @foreach (var error in modelState.Errors)
                            {
                                <li class="text-sm">‚Ä¢ @error.ErrorMessage</li>
                            }
                        }
                    </ul>
                </div>
            }

            <input type="hidden" name="id" value="@Model.Id" />

            <!-- T√≠tulo -->
            <div>
                <label for="titulo" class="block text-gray-700 font-bold mb-2">
                    T√≠tulo <span class="text-red-600">*</span>
                </label>
                <input type="text" id="titulo" name="titulo" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                       value="@indexModel.GetTituloEncuesta(ViewBag.FiltroTipo ?? "")"
                       @indexModel.GetAtributoDisabled(Model.Estado) />
            </div>

            <!-- Clave de acceso -->
            <div class="flex gap-6">
                <div class="flex-1">
                    <label for="claveAcceso" class="block text-gray-700 font-bold mb-2">
                        Clave de acceso
                    </label>
                    <input type="text" id="claveAcceso" name="claveAcceso"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           value="@indexModel.GetClaveAccesoEncuesta(ViewBag.FiltroTipo ?? "")" />
                </div>
            </div>

            <!-- Bot√≥n Agregar Pregunta -->
            <div>
                <button type="button" onclick="document.getElementById('modalAgregarPregunta').classList.remove('hidden')" class="w-full bg-blue-100 text-blue-600 py-3 rounded-lg hover:bg-blue-200 transition font-bold">
                    ‚ûï Agregar Pregunta
                </button>
            </div>

            <!-- Tabla de Preguntas -->
            <div class="mt-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4">Preguntas</h3>
                @{
                    var filasPreguntas = indexModel.ObtenerFilasPreguntasDeBaseDatos(ViewBag.FiltroTipo ?? "");
                }
                @if (filasPreguntas.Count > 0)
                {
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">N√∫mero</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">Pregunta</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">Pregunta Ingl√©s</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">Competencia</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">Actividad</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-gray-700 font-bold">Descripci√≥n Perfil</th>
                                    <th class="border border-gray-300 px-4 py-3 text-center text-gray-700 font-bold">Opciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int numeroPreg = 1;
                                    foreach (var fila in filasPreguntas)
                                    {
                                        <tr class="hover:bg-gray-50">
                                            <td class="border border-gray-300 px-4 py-3 text-gray-900 hidden">@indexModel.ObtenerValorDataRow(fila, "IDPregunta")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-900">@indexModel.ObtenerValorDataRow(fila, "nOrden")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-900">@indexModel.ObtenerValorDataRow(fila, "cPregunta")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-600">@indexModel.ObtenerValorDataRow(fila, "cPregunta_Ingles")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-600">@indexModel.ObtenerValorDataRow(fila, "cCompetencia")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-600">@indexModel.ObtenerValorDataRow(fila, "cActividad")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-gray-600">@indexModel.ObtenerValorDataRow(fila, "cDescripcion")</td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">
                                                <div class="flex justify-center space-x-2">
                                                    <button type="button" class="text-green-600 hover:text-green-800 text-lg" onclick="moverPreguntaArriba(this)">‚¨ÜÔ∏è</button>
                                                    <button type="button" class="text-green-600 hover:text-green-800 text-lg" onclick="moverPreguntaAbajo(this)">‚¨áÔ∏è</button>
                                                    <button type="button" class="text-blue-600 hover:text-blue-800 text-lg edit-btn" onclick="abrirModalEditar(this)">‚úèÔ∏è</button>
                                                    <button type="button" class="text-red-600 hover:text-red-800 text-lg delete-btn" onclick="eliminarPregunta(this)">üóëÔ∏è</button>
                                                </div>
                                            </td>
                                        </tr>
                                        numeroPreg++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-8 bg-gray-100 rounded-lg">
                        <p class="text-gray-600">No hay preguntas en esta encuesta</p>
                        <button type="button" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition font-bold">
                            ‚ûï Crear Primera Pregunta
                        </button>
                    </div>
                }
            </div>

            <!-- Botones -->
            <div class="flex space-x-4 mt-8">
                <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-bold">
                    ‚úì Guardar Cambios
                </button>
                <a asp-controller="Encuesta" asp-action="Index" asp-route-filtroTipo="@ViewBag.FiltroTipo" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-lg hover:bg-gray-400 transition font-bold text-center">
                    ‚Üê Cancelar
                </a>
            </div>
        </form>
    </div>

    <!-- Modal Agregar Pregunta -->
    <div id="modalAgregarPregunta" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Agregar Nueva Pregunta</h2>
                <button type="button" onclick="document.getElementById('modalAgregarPregunta').classList.add('hidden')" class="text-gray-500 hover:text-gray-700 text-2xl">
                    ‚úï
                </button>
            </div>

            <form id="formAgregarPregunta" method="post" asp-action="CreatePregunta" asp-route-filtroTipo="@(ViewBag.FiltroTipo ?? "")" class="space-y-4">
                <input type="hidden" name="encuestaId" value="@Model.Id" />

                <!-- Pregunta en Espa√±ol -->
                <div>
                    <label for="cPregunta" class="block text-gray-700 font-bold mb-2">
                        Pregunta (Espa√±ol) <span class="text-red-600">*</span>
                    </label>
                    <input type="text" id="cPregunta" name="cPregunta" required maxlength="500"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Ingrese la pregunta en espa√±ol" />
                </div>

                <!-- Pregunta en Ingl√©s -->
                <div>
                    <label for="cPregunta_Ingles" class="block text-gray-700 font-bold mb-2">
                        Pregunta (Ingl√©s) <span class="text-red-600">*</span>
                    </label>
                    <input type="text" id="cPregunta_Ingles" name="cPregunta_Ingles" required maxlength="500"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Enter the question in English" />
                </div>

                <!-- Competencia -->
                <div>
                    <label for="cCompetencia" class="block text-gray-700 font-bold mb-2">
                        Competencia <span class="text-red-600">*</span>
                    </label>
                    <select id="cCompetencia" name="cCompetencia" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una competencia --</option>
                        @{
                            var competencias = indexModel.ObtenerCompetencias();
                            foreach (var competencia in competencias)
                            {
                                <option value="@competencia.Value">@competencia.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Actividad -->
                <div>
                    <label for="cActividad" class="block text-gray-700 font-bold mb-2">
                        Actividad <span class="text-red-600">*</span>
                    </label>
                    <select id="cActividad" name="cActividad" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una actividad --</option>
                        @{
                            var actividades = indexModel.ObtenerActividades();
                            foreach (var actividad in actividades)
                            {
                                <option value="@actividad.Value">@actividad.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Descripci√≥n -->
                <div>
                    <label for="cDescripcion" class="block text-gray-700 font-bold mb-2">
                        Descripci√≥n del Perfil <span class="text-red-600">*</span>
                    </label>
                    <select id="cDescripcion" name="cDescripcion" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una descripci√≥n --</option>
                        @{
                            var descripciones = indexModel.ObtenerDescripciones();
                            foreach (var descripcion in descripciones)
                            {
                                <option value="@descripcion.Value">@descripcion.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Orden (n√∫mero de pregunta) -->
                <div>
                    <label for="nOrden" class="block text-gray-700 font-bold mb-2">
                        N√∫mero de Orden <span class="text-red-600">*</span>
                    </label>
                    <input type="number" id="nOrden" name="nOrden" required min="1" max="999" readonly
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100 cursor-not-allowed"
                           value="@indexModel.ObtenerProximoNumeroOrden(ViewBag.FiltroTipo ?? "")"
                           placeholder="Ej: 1" />
                </div>

                <!-- Botones de acci√≥n -->
                <div class="flex gap-4 pt-4 border-t border-gray-200">
                    <button type="submit" class="flex-1 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-bold">
                        üíæ Guardar Pregunta
                    </button>
                    <button type="button" onclick="document.getElementById('modalAgregarPregunta').classList.add('hidden')" class="flex-1 bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition font-bold">
                        ‚úï Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Pregunta -->
    <div id="modalEditarPregunta" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Editar Pregunta</h2>
                <button type="button" onclick="document.getElementById('modalEditarPregunta').classList.add('hidden')" class="text-gray-500 hover:text-gray-700 text-2xl">
                    ‚úï
                </button>
            </div>

            <form id="formEditarPregunta" method="post" asp-action="UpdatePregunta" asp-route-filtroTipo="@(ViewBag.FiltroTipo ?? "")" class="space-y-4">
                <input type="hidden" id="editIDPregunta" name="idPregunta" />
                <input type="hidden" name="encuestaId" value="@Model.Id" />

                <!-- Pregunta en Espa√±ol -->
                <div>
                    <label for="editCPregunta" class="block text-gray-700 font-bold mb-2">
                        Pregunta (Espa√±ol) <span class="text-red-600">*</span>
                    </label>
                    <input type="text" id="editCPregunta" name="cPregunta" required maxlength="500"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Ingrese la pregunta en espa√±ol" />
                </div>

                <!-- Pregunta en Ingl√©s -->
                <div>
                    <label for="editCPreguntaIngles" class="block text-gray-700 font-bold mb-2">
                        Pregunta (Ingl√©s) <span class="text-red-600">*</span>
                    </label>
                    <input type="text" id="editCPreguntaIngles" name="cPregunta_Ingles" required maxlength="500"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Enter the question in English" />
                </div>

                <!-- Competencia -->
                <div>
                    <label for="editCCompetencia" class="block text-gray-700 font-bold mb-2">
                        Competencia <span class="text-red-600">*</span>
                    </label>
                    <select id="editCCompetencia" name="cCompetencia" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una competencia --</option>
                        @{
                            var competenciasEdit = indexModel.ObtenerCompetencias();
                            foreach (var competencia in competenciasEdit)
                            {
                                <option value="@competencia.Value">@competencia.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Actividad -->
                <div>
                    <label for="editCActividad" class="block text-gray-700 font-bold mb-2">
                        Actividad <span class="text-red-600">*</span>
                    </label>
                    <select id="editCActividad" name="cActividad" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una actividad --</option>
                        @{
                            var actividadesEdit = indexModel.ObtenerActividades();
                            foreach (var actividad in actividadesEdit)
                            {
                                <option value="@actividad.Value">@actividad.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Descripci√≥n -->
                <div>
                    <label for="editCDescripcion" class="block text-gray-700 font-bold mb-2">
                        Descripci√≥n del Perfil <span class="text-red-600">*</span>
                    </label>
                    <select id="editCDescripcion" name="cDescripcion" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Seleccione una descripci√≥n --</option>
                        @{
                            var descripcionesEdit = indexModel.ObtenerDescripciones();
                            foreach (var descripcion in descripcionesEdit)
                            {
                                <option value="@descripcion.Value">@descripcion.Key</option>
                            }
                        }
                    </select>
                </div>

                <!-- Orden (n√∫mero de pregunta) -->
                <div>
                    <label for="editNOrden" class="block text-gray-700 font-bold mb-2">
                        N√∫mero de Orden <span class="text-red-600">*</span>
                    </label>
                    <input type="number" id="editNOrden" name="nOrden" required min="1" max="999" readonly
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100 cursor-not-allowed"
                           placeholder="Ej: 1" />
                </div>

                <!-- Botones de acci√≥n -->
                <div class="flex gap-4 pt-4 border-t border-gray-200">
                    <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition font-bold">
                        üíæ Guardar Cambios
                    </button>
                    <button type="button" onclick="document.getElementById('modalEditarPregunta').classList.add('hidden')" class="flex-1 bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition font-bold">
                        ‚úï Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function abrirModalEditar(button) {
            // Obtener la fila actual
            const fila = button.closest('tr');
            
            // Obtener los datos de las celdas
            const celdas = fila.querySelectorAll('td');
            
            // Obtener el IDPregunta (primera celda oculta - √≠ndice 0)
            const idPregunta = celdas[0].textContent.trim();
            
            // Obtener el resto de datos
            const nOrden = celdas[1].textContent.trim();
            const cPregunta = celdas[2].textContent.trim();
            const cPreguntaIngles = celdas[3].textContent.trim();
            const cCompetencia = celdas[4].textContent.trim();
            const cActividad = celdas[5].textContent.trim();
            const cDescripcion = celdas[6].textContent.trim();
            
            // Llenar el formulario del modal de edici√≥n
            document.getElementById('editIDPregunta').value = idPregunta;
            document.getElementById('editCPregunta').value = cPregunta;
            document.getElementById('editCPreguntaIngles').value = cPreguntaIngles;
            document.getElementById('editNOrden').value = nOrden;
            
            // Opcional: Establecer los selects si necesitas pre-seleccionar valores
            // document.getElementById('editCCompetencia').value = cCompetencia;
            // document.getElementById('editCActividad').value = cActividad;
            // document.getElementById('editCDescripcion').value = cDescripcion;
            
            console.log('IDPregunta:', idPregunta); // Para debugging
            
            // Mostrar el modal
            document.getElementById('modalEditarPregunta').classList.remove('hidden');
        }

        function eliminarPregunta(button) {
            // Obtener la fila actual
            const fila = button.closest('tr');
            
            // Obtener los datos de las celdas
            const celdas = fila.querySelectorAll('td');
            
            // Obtener el IDPregunta (primera celda oculta - √≠ndice 0)
            const idPregunta = parseInt(celdas[0].textContent.trim());
            
            // Confirmar la eliminaci√≥n
            if (!confirm('¬øEst√°s seguro de que deseas eliminar esta pregunta?')) {
                return;
            }

            // Obtener los datos necesarios para la solicitud
            const encuestaId = @Model.Id;
            const filtroTipo = '@ViewBag.FiltroTipo';

            // Realizar la solicitud AJAX para desactivar la pregunta
            fetch(`/EditaEncuesta/DeletePregunta?idPregunta=${idPregunta}`, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Error en la solicitud');
            })
            .then(data => {
                if (data.success) {
                    // Remover la fila de la tabla
                    fila.remove();
                    alert('Pregunta eliminada correctamente.');
                    // Recargar la p√°gina para actualizar la vista
                    location.reload();
                } else {
                    alert('Error: ' + (data.message || 'No se pudo eliminar la pregunta.'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al eliminar la pregunta: ' + error.message);
            });
        }

        function moverPreguntaArriba(button) {
            // Obtener la fila actual
            const fila = button.closest('tr');
            
            // Obtener la fila anterior
            const filaAnterior = fila.previousElementSibling;
            
            // Validar que exista una fila anterior
            if (!filaAnterior) {
                alert('No se puede mover la pregunta hacia arriba.');
                return;
            }
            
            // Obtener los datos de las celdas de la fila actual
            const celdas = fila.querySelectorAll('td');
            const idPregunta = parseInt(celdas[0].textContent.trim());
            const nOrden = parseInt(celdas[1].textContent.trim());
            
            // Obtener el IDPregunta de la fila anterior (primera celda oculta)
            const celdasAnterior = filaAnterior.querySelectorAll('td');
            const idPreguntaAnterior = parseInt(celdasAnterior[0].textContent.trim());
            
            // Realizar la solicitud AJAX para mover la pregunta hacia arriba
            fetch(`/EditaEncuesta/MoverPreguntaArriba?idPregunta=${idPregunta}&nOrden=${nOrden}&idPreguntaAnterior=${idPreguntaAnterior}`, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Error en la solicitud');
            })
            .then(data => {
                if (data.success) {
                    // Recargar la p√°gina para actualizar la vista
                    location.reload();
                } else {
                    alert('Error: ' + (data.message || 'No se pudo mover la pregunta.'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al mover la pregunta: ' + error.message);
            });
        }

        function moverPreguntaAbajo(button) {
            // Obtener la fila actual
            const fila = button.closest('tr');
            
            // Obtener la fila siguiente
            const filaSiguiente = fila.nextElementSibling;
            
            // Validar que exista una fila siguiente
            if (!filaSiguiente) {
                alert('No se puede mover la pregunta hacia abajo.');
                return;
            }
            
            // Obtener los datos de las celdas de la fila actual
            const celdas = fila.querySelectorAll('td');
            const idPregunta = parseInt(celdas[0].textContent.trim());
            const nOrden = parseInt(celdas[1].textContent.trim());
            
            // Obtener el IDPregunta de la fila siguiente (primera celda oculta)
            const celdasSiguiente = filaSiguiente.querySelectorAll('td');
            const idPreguntaSiguiente = parseInt(celdasSiguiente[0].textContent.trim());
            
            // Realizar la solicitud AJAX para mover la pregunta hacia abajo
            fetch(`/EditaEncuesta/MoverPreguntaAbajo?idPregunta=${idPregunta}&nOrden=${nOrden}&idPreguntaSiguiente=${idPreguntaSiguiente}`, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Error en la solicitud');
            })
            .then(data => {
                if (data.success) {
                    // Recargar la p√°gina para actualizar la vista
                    location.reload();
                } else {
                    alert('Error: ' + (data.message || 'No se pudo mover la pregunta.'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al mover la pregunta: ' + error.message);
            });
        }
    </script>
}



